// Sysinternals Tools Zero Day Vulnerability Detection

// https://www.foto-video-it.de/2025/allgemein/disclosure-sysinternals/

let SysinternalsTools=externaldata(RawData:string)
[h'https://raw.githubusercontent.com/SlimKQL/Hunting-Queries-Detection-Rules/refs/heads/main/IOC/SysinternalsTools.txt']
| parse RawData with BinariesName:string;
let SysinternalsToolsBinaries =
SysinternalsTools
| project BinariesName;
let SuspiciousSysInternalsEP =
DeviceEvents
| where FolderPath startswith "\\\\"
| where FileName has_any(SysinternalsToolsBinaries)
| distinct DeviceName;
DeviceEvents
| where ActionType == @"DriverLoad"
| where FileName endswith ".dll"
| where FolderPath startswith "\\\\"
| where DeviceName has_any(SuspiciousSysInternalsEP)
