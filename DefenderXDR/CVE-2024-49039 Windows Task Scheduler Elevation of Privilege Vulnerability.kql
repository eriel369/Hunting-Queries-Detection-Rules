// Zero-Day ðŸª² CVE-2024-49039
// https://msrc.microsoft.com/update-guide/vulnerability/CVE-2024-49039
// A KQL query to detect an authenticated attacker who initially runs a low-privilege AppContainer, which is later elevated with privileges, referencing the Microsoft CVE-2024-49039 Windows Task Scheduler Elevation of Privilege Vulnerability.

let VulnerableEndpoint = 
DeviceTvmSoftwareVulnerabilities
| where CveId == "CVE-2024-49039"
| distinct DeviceName;
let VulnerableEPwithAppContainer =
DeviceProcessEvents
| where ProcessCommandLine contains "/appcontainer"
| where DeviceName has_any(VulnerableEndpoint)
| distinct DeviceName;
DeviceProcessEvents
| where DeviceName has_any(VulnerableEPwithAppContainer)
| where ProcessTokenElevation == "TokenElevationTypeFull"

