// Critical Vulnerability in Elastic Kibana
// https://www.csa.gov.sg/alerts-and-advisories/alerts/al-2025-022

// Locate internet facing Elastic Kibana with upmost priority

let InternetFacing =
DeviceInfo
| where IsInternetFacing == true and isnotempty(PublicIP)
| distinct DeviceId;
DeviceProcessEvents
| where TimeGenerated > ago(90d)
| where InitiatingProcessCommandLine has "kibana"
| summarize arg_max(TimeGenerated, *) by DeviceId
| where DeviceId has_any(InternetFacing)
